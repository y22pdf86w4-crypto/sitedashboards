<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Login – Dashboards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="assets/css/global.css" />
  <script src="assets/js/global.js"></script>
</head>
<body class="login-page">
  <!-- Fundo animado -->
  <div class="bg-container">
    <div class="animated-bg"></div>
    <div class="particles-container"></div>
    <div class="wave-container">
      <div class="wave"></div>
      <div class="wave"></div>
      <div class="wave"></div>
    </div>
    <div class="glow-orb orb-1"></div>
    <div class="glow-orb orb-2"></div>
    <div class="grid-bg"></div>
  </div>

  <div class="container">
    <!-- Lado esquerdo (texto) -->
    <section class="left-section">
      <div class="header-brand">
        <div class="brand-text">
          <h1>Portal de Dashboards</h1>
          <p>Visualização integrada Linhagro & Lithoplant</p>
        </div>
      </div>

      <div class="hero-section">
        <h2 class="hero-title">
          Acesse seus <span>dashboards corporativos</span>
        </h2>
        <p class="hero-description">
          Central único de acesso aos principais indicadores de negócio das empresas Linhagro e Lithoplant,
          com controle de permissão por usuário.
        </p>
      </div>
    </section>

    <!-- Lado direito (login) -->
    <section class="right-section">
      <div class="login-wrapper">
        <div class="login-card">
          <div class="card-header">
            <h2>Login</h2>
            <p>Use seu e-mail corporativo ou usuário admin para acessar.</p>
          </div>

          <div id="erro" class="error-msg" style="display:none;">
            <span>Usuário ou senha inválidos.</span>
          </div>

          <div class="form-group">
            <label class="form-label" for="usuario">Usuário</label>
            <div class="input-wrapper">
              <input
                type="text"
                id="usuario"
                class="form-input"
                placeholder="Usuário (e-mail ou admin)"
                autocomplete="username"
              />
              <span class="input-icon">👤</span>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="senha">Senha</label>
            <div class="input-wrapper">
              <input
                type="password"
                id="senha"
                class="form-input"
                placeholder="Digite sua senha"
                autocomplete="current-password"
                onkeypress="if(event.key==='Enter'){login();}"
              />
              <span class="input-icon input-toggle-pwd" onclick="toggleSenha()">👁</span>
            </div>
          </div>

          <button id="btnLogin" class="login-btn" onclick="login()">
            Entrar
            <span class="btn-loading-spinner"></span>
          </button>

          <div class="security-badge">
            <div class="security-icon">✓</div>
            <span>Acesso restrito. Monitoramento de logins ativos.</span>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // Mostrar / ocultar senha
    function toggleSenha() {
      const input = document.getElementById('senha');
      input.type = input.type === 'password' ? 'text' : 'password';
    }

    function login() {
      const usuario = document.getElementById("usuario").value;
      const senha = document.getElementById("senha").value;
      const btn = document.getElementById("btnLogin");
      const erro = document.getElementById("erro");

      erro.style.display = "none";

      const user = loginSistema(usuario, senha);

      if (!user) {
        erro.style.display = "flex";
        return;
      }

      // loading visual
      btn.classList.add("loading");

      // Se o usuário só tiver UMA empresa, redireciona direto
      if (user.empresas && user.empresas.length === 1) {
        const emp = user.empresas[0];

        if (emp === "linhagro") {
          window.location.href = "linhagro/menu.html";
        } else if (emp === "lithoplant") {
          window.location.href = "lithoplant/menu.html";
        } else {
          // fallback
          window.location.href = "select-company.html";
        }
        return;
      }

      // Se tiver mais de uma empresa, vai para select-company escolher
      setTimeout(() => {
        window.location.href = "select-company.html";
      }, 300);
    }

    // partículas
    (function gerarParticulas() {
      const container = document.querySelector('.particles-container');
      if (!container) return;
      for (let i = 0; i < 35; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = Math.random() * 100 + 'vw';
        p.style.animationDelay = (Math.random() * 20) + 's';
        p.style.opacity = Math.random();
        container.appendChild(p);
      }
    })();
  </script>
</body>
</html>
